package cux.oracle.apps.per.bonus.searchlist;

import java.sql.Date;

import oracle.apps.fnd.framework.OAException;
import oracle.apps.fnd.framework.server.OAApplicationModuleImpl;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class MonthAndDeptAMImpl extends OAApplicationModuleImpl {
    /**This is the default constructor (do not remove)
     */
    public MonthAndDeptAMImpl() {
    }

    /**Sample main for debugging Business Components code using the tester.
     */
    public static void main(String[] args) { /* package name */
        /* Configuration Name */launchTester("cux.oracle.apps.per.bonus.test", 
                                             "MonthAndDeptAMLocal");
    }

    /**Container's getter for MonthVO1
     */
    public MonthVOImpl getMonthVO1() {
        return (MonthVOImpl)findViewObject("MonthVO1");
    }

    /**Container's getter for DeptOV1
     */
    public DeptOVImpl getDeptOV1() {
        return (DeptOVImpl)findViewObject("DeptOV1");
    }

    /**Container's getter for searchVO1
     */
    public searchVOImpl getsearchVO1() {
        return (searchVOImpl)findViewObject("searchVO1");
    }

    public void searchByDate(String distributionDate) {

        if ((distributionDate != null)) {
            searchVOImpl vo = this.getsearchVO1();

            vo.setWhereClauseParams(null);
            vo.setWhereClauseParam(0, distributionDate);

            vo.executeQuery();
        }
    }

    public void search(String distributionDate, String dept) {

        if ((distributionDate != null) && (!("".equals(dept.trim())))) {
            searchVOImpl vo = this.getsearchVO1();
            String sql = 
                "select distinct(person_distribution_id), t1.person_id,t2.last_name,t3.element_name,t1.distribution_amount,t1.distributiondep_name \n" + 
                "from cux_bonus_person_distribution t1 \n" + 
                "join per_all_people_f t2 on t1.person_id=t2.person_id \n" + 
                "join cux_bonus_type t4 on t1.type_id=t4.type_id \n" + 
                "join pay_element_types_f_tl t3 on t4.hr_type_id=t3.element_type_id\n" + 
                "where t1.distribution_date <= LAST_DAY(to_date('" + 
                distributionDate + "','yyyy-mm')) \n" + 
                "and t1.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                distributionDate + "','yyyy-mm')) + 1, -1) \n" + 
                "and t1.dep_name='" + dept + 
                "' and t1.distribution_status in ('已批准','已提交') and t1.distribution_status not in ('已退回')";

            vo.cancelQuery();
            vo.setQuery(sql);
            vo.executeQuery();


            /* searchVOImpl vo=this.getsearchVO1();

               vo.setWhereClauseParams(null);
               vo.setWhereClauseParam(0,distributionDate);
                vo.setWhereClauseParam(1,dept);

               vo.executeQuery();*/

        }
    }

    public void searchByDept(String dept) {

        if ((!("".equals(dept.trim())))) {
            searchVOImpl vo = this.getsearchVO1();

            vo.setWhereClauseParams(null);
            vo.setWhereClauseParam(0, dept);
            vo.executeQuery();
        }

    }

    /**Container's getter for YearVO1
     */
    public YearVOImpl getYearVO1() {
        return (YearVOImpl)findViewObject("YearVO1");
    }

    /**Container's getter for DeptBonusVO1
     */
    public DeptBonusVOImpl getDeptBonusVO1() {
        return (DeptBonusVOImpl)findViewObject("DeptBonusVO1");
    }


    public void searchDeptBonus(String year, String dept) {

        if ((year != null) && (!("".equals(dept.trim()))) && dept != null) {
            DeptBonusVOImpl vo = this.getDeptBonusVO1();
            String sql = 
                "select \n" + "distinct(cux_bonus_person_distribution.person_id) id,\n" + 
                "per_all_people_f.last_name name,\n" + 
                "cux_bonus_person_distribution.dep_name dep_name,\n" + 
                "nvl(JanSearch.amout,0) Jan,\n" + 
                "nvl(FebSearch.amout,0) Feb,\n" + 
                "nvl(MarSearch.amout,0) Mar,\n" + 
                "nvl(AprilSearch.amout,0) April,\n" + 
                "nvl(MaySearch.amout,0) May,\n" + 
                "nvl(JuneSearch.amout,0) June,\n" + 
                "nvl(JulySearch.amout,0) July,\n" + 
                "nvl(AugSearch.amout,0) Aug,\n" + 
                "nvl(SepSearch.amout,0) Sep,\n" + 
                "nvl(OctSearch.amout,0) Oct,\n" + 
                "nvl(NovSearch.amout,0) Nov,\n" + 
                "nvl(DecSearch.amout,0) Dec,\n" + 
                "nvl(YearSearch.amout,0) Year,\n" + "\n" + 
                "nvl(JanSearch.amout,0) + nvl(FebSearch.amout,0) + nvl(MarSearch.amout,0)\n" + 
                "+nvl(AprilSearch.amout,0)+nvl(MaySearch.amout,0)+nvl(JuneSearch.amout,0)\n" + 
                "+nvl(JulySearch.amout,0)+ nvl(AugSearch.amout,0)+nvl(SepSearch.amout,0)\n" + 
                "+nvl(OctSearch.amout,0)+nvl(NovSearch.amout,0)+nvl(DecSearch.amout,0)\n" + 
                "+nvl(YearSearch.amout,0) as total\n" + "\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-01','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "'|| '-01','yyyy-\n" + "mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") JanSearch on JanSearch.person_id=per_all_people_f.person_id \n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-02','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-02','yyyy-\n" + "mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") FebSearch on FebSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-03','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-03','yyyy-\n" + "mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") MarSearch on MarSearch.person_id=per_all_people_f.person_id \n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-04','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-04','yyyy-\n" + "mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") AprilSearch on AprilSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-05','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-05','yyyy-\n" + "mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") MaySearch on MaySearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-06','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-06','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") JuneSearch on JuneSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-07','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-07','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") JulySearch on JulySearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-08','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-08','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") AugSearch on AugSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-09','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-09','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") SepSearch on SepSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-10','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-10','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") OctSearch on OctSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-11','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-11','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") NovSearch on NovSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-12','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-12','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") DecSearch on DecSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id=8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-01','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-12','yyyy-\n" + "mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") YearSearch on YearSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and " + 
                "cux_bonus_person_distribution.dep_name='" + dept + "' and " + 
                "(nvl(JanSearch.amout,0) + nvl(FebSearch.amout,0) + nvl(MarSearch.amout,0)\n" + 
                "+nvl(AprilSearch.amout,0)+nvl(MaySearch.amout,0)+nvl(JuneSearch.amout,0)\n" + 
                "+nvl(JulySearch.amout,0)+ nvl(AugSearch.amout,0)+nvl(SepSearch.amout,0)\n" + 
                "+nvl(OctSearch.amout,0)+nvl(NovSearch.amout,0)+nvl(DecSearch.amout,0)\n" + 
                "+nvl(YearSearch.amout,0)) <> 0";


            vo.cancelQuery();
            vo.setQuery(sql);
            vo.executeQuery();

        }
    }

    public void searchDeptBonusByYear(String year) {
        if ((year != null)) {
            DeptBonusVOImpl vo = this.getDeptBonusVO1();
            String sql = 
                "select \n" + "distinct(cux_bonus_person_distribution.person_id) id,\n" + 
                "per_all_people_f.last_name name,\n" + 
                "cux_bonus_person_distribution.dep_name dep_name,\n" + 
                "nvl(JanSearch.amout,0) Jan,\n" + 
                "nvl(FebSearch.amout,0) Feb,\n" + 
                "nvl(MarSearch.amout,0) Mar,\n" + 
                "nvl(AprilSearch.amout,0) April,\n" + 
                "nvl(MaySearch.amout,0) May,\n" + 
                "nvl(JuneSearch.amout,0) June,\n" + 
                "nvl(JulySearch.amout,0) July,\n" + 
                "nvl(AugSearch.amout,0) Aug,\n" + 
                "nvl(SepSearch.amout,0) Sep,\n" + 
                "nvl(OctSearch.amout,0) Oct,\n" + 
                "nvl(NovSearch.amout,0) Nov,\n" + 
                "nvl(DecSearch.amout,0) Dec,\n" + 
                "nvl(YearSearch.amout,0) Year,\n" + "\n" + 
                "nvl(JanSearch.amout,0) + nvl(FebSearch.amout,0) + nvl(MarSearch.amout,0)\n" + 
                "+nvl(AprilSearch.amout,0)+nvl(MaySearch.amout,0)+nvl(JuneSearch.amout,0)\n" + 
                "+nvl(JulySearch.amout,0)+ nvl(AugSearch.amout,0)+nvl(SepSearch.amout,0)\n" + 
                "+nvl(OctSearch.amout,0)+nvl(NovSearch.amout,0)+nvl(DecSearch.amout,0)\n" + 
                "+nvl(YearSearch.amout,0) as total\n" + "\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-01','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "'|| '-01','yyyy-\n" + "mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") JanSearch on JanSearch.person_id=per_all_people_f.person_id \n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-02','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-02','yyyy-\n" + "mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") FebSearch on FebSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-03','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-03','yyyy-\n" + "mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") MarSearch on MarSearch.person_id=per_all_people_f.person_id \n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-04','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-04','yyyy-\n" + "mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") AprilSearch on AprilSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-05','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-05','yyyy-\n" + "mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") MaySearch on MaySearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-06','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-06','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") JuneSearch on JuneSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-07','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-07','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") JulySearch on JulySearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-08','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-08','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") AugSearch on AugSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-09','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-09','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") SepSearch on SepSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-10','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-10','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") OctSearch on OctSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-11','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-11','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") NovSearch on NovSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id<>8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回') and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-12','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-12','yyyy-mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") DecSearch on DecSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + "left join \n" + "(select \n" + 
                "cux_bonus_person_distribution.person_id person_id,\n" + 
                "sum(cux_bonus_person_distribution.distribution_amount) amout\n" + 
                "from cux_bonus_person_distribution,per_all_people_f\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and \n" + 
                "cux_bonus_person_distribution.type_id=8 and\n" + 
                "cux_bonus_person_distribution.distribution_status in ('已批准','已提交') and cux_bonus_person_distribution.distribution_status not in ('已退回')and\n" + 
                "cux_bonus_person_distribution.distribution_date <= LAST_DAY(to_date('" + 
                year + "' || '-01','yyyy-mm')) and \n" + 
                "cux_bonus_person_distribution.distribution_date>=ADD_MONTHS(LAST_DAY(to_date('" + 
                year + "' || '-12','yyyy-\n" + "mm')) + 1, -1) \n" + "\n" + 
                "group by trunc(distribution_date,'mm'),\n" + "\n" + 
                "cux_bonus_person_distribution.person_id\n" + 
                ") YearSearch on YearSearch.person_id=per_all_people_f.person_id\n" + 
                "\n" + 
                "where cux_bonus_person_distribution.person_id=per_all_people_f.person_id and " + 
                "(nvl(JanSearch.amout,0) + nvl(FebSearch.amout,0) + nvl(MarSearch.amout,0)\n" + 
                "+nvl(AprilSearch.amout,0)+nvl(MaySearch.amout,0)+nvl(JuneSearch.amout,0)\n" + 
                "+nvl(JulySearch.amout,0)+ nvl(AugSearch.amout,0)+nvl(SepSearch.amout,0)\n" + 
                "+nvl(OctSearch.amout,0)+nvl(NovSearch.amout,0)+nvl(DecSearch.amout,0)\n" + 
                "+nvl(YearSearch.amout,0)) <> 0";

            vo.cancelQuery();
            vo.setQuery(sql);
            vo.executeQuery();

        }
    }
}
