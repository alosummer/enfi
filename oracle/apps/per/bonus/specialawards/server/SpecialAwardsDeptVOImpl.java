package cux.oracle.apps.per.bonus.specialawards.server;

import java.math.BigDecimal;

import java.sql.CallableStatement;
import java.sql.Types;


import oracle.apps.fnd.framework.server.OADBTransaction;
import oracle.apps.fnd.framework.server.OAViewObjectImpl;

import oracle.jbo.Row;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class SpecialAwardsDeptVOImpl extends OAViewObjectImpl {
    /**This is the default constructor (do not remove)
     */
    public SpecialAwardsDeptVOImpl() {
    }

    public void initQuery(String searchBonusType, Integer intDistDate) {
        if (searchBonusType == null || "".equals(searchBonusType) || 
            intDistDate == null)
            return;
        SpecialAwardsAMImpl amImpl = 
            (SpecialAwardsAMImpl)this.getApplicationModule();
        int distCount = amImpl.getDeptDistNum(searchBonusType, intDistDate);

        if (distCount == 0) { //若本月未分配部门奖金，则自动带出上月的奖金
            setWhereClause("TYPE_NAME = :1 AND DISTRIBUTION_PERIOD = :2 AND DISTRIBUTION_STATUS = '已批准'");
            setWhereClauseParams(null);
            setWhereClauseParam(0, searchBonusType);
            if ("绩效奖金".equals(searchBonusType)) {
                if ("01".equals(String.valueOf(intDistDate).substring(4, 6))) {
                    intDistDate = intDistDate - 100 + 12; //若是1月份，则取去年12月的数据
                }
                setWhereClauseParam(1, intDistDate - 1);
            } else { //年终奖，自动带出去年的数据
                setWhereClauseParam(1, intDistDate - 100);
            }
            executeQuery();
            Row[] oldRow = getFilteredRows("Attribute1", "Y");
            for (int i = 0; i < oldRow.length; ++i) {
                Row pRow = oldRow[i];
                pRow.setAttribute("Attribute1", "N");
                pRow.setAttribute("DistributionStatus", null);
                pRow.setAttribute("DepDistributionId", null);
                pRow.setAttribute("Deletestatus", "dDeleteEnabled");
                pRow.setAttribute("AttachmentStatus", "dAttachmentDisabled");
                pRow.setAttribute("ReadOnlyFlag", false);
            } // end for 
        } else {
            setWhereClause("TYPE_NAME = :1 AND DISTRIBUTION_PERIOD = :2");
            setWhereClauseParams(null);
            setWhereClauseParam(0, searchBonusType);
            setWhereClauseParam(1, intDistDate);
            executeQuery();
        }
        setMaxFetchSize(-1);
    } //end initQuery
}
